<div class="dialog-container" (click)="onOverlayClick($event)">
    <div class="dialog-content">
        <mat-card>
            <mat-card-header>
                <mat-card-title>Додати нову ціль</mat-card-title>
            </mat-card-header>

            <mat-card-content>
                <form (ngSubmit)="saveGoal()" class="dialog-content-form" [formGroup]="goalForm">
                    <!-- Goal Name -->
                    <mat-form-field appearance="outline">
                        <mat-label>Назва цілі</mat-label>
                        <input
                            matInput
                            formControlName="name"
                            type="text"
                            required
                            placeholder="Введіть назву цілі"
                        />
                        @if (hasError('name', 'required')) {
                            <mat-error>
                                Назва є обов'язковою
                            </mat-error>
                        }
                        @if (hasError('name', 'minlength')) {
                            <mat-error>
                                Назва повинна містити принаймні 2 символи
                            </mat-error>
                        }
                    </mat-form-field>

                    <!-- Description -->
                    <mat-form-field appearance="outline">
                        <mat-label>Опис</mat-label>
                        <textarea
                            matInput
                            formControlName="description"
                            placeholder="Введіть опис цілі (необов'язково)"
                            rows="3"
                        ></textarea>
                        <mat-hint>Детальний опис вашої цілі</mat-hint>
                    </mat-form-field>

                    <!-- Target Value and Unit -->
                    <div class="form-row">
                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Цільове значення</mat-label>
                            <input
                                matInput
                                formControlName="targetValue"
                                type="number"
                                placeholder="100"
                                min="0"
                            />
                            @if (hasError('targetValue', 'min')) {
                                <mat-error>
                                    Значення повинно бути більше або дорівнювати 0
                                </mat-error>
                            }
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Одиниця виміру</mat-label>
                            <input
                                matInput
                                formControlName="unit"
                                type="text"
                                placeholder="кг, год, разів"
                            />
                            <mat-hint>Наприклад: кг, години, рази</mat-hint>
                        </mat-form-field>
                    </div>

                    <!-- Current Value -->
                    <mat-form-field appearance="outline">
                        <mat-label>Поточне значення</mat-label>
                        <input
                            matInput
                            formControlName="currentValue"
                            type="number"
                            placeholder="0"
                            min="0"
                        />
                        <mat-hint>Ваш поточний прогрес</mat-hint>
                        @if (hasError('currentValue', 'min')) {
                            <mat-error>
                                Значення повинно бути більше або дорівнювати 0
                            </mat-error>
                        }
                    </mat-form-field>

                    <!-- Date Range -->
                    <div class="form-row">
                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Дата початку</mat-label>
                            <input
                                matInput
                                formControlName="startDate"
                                [matDatepicker]="startPicker"
                            />
                            <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                            <mat-datepicker #startPicker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="half-width">
                            <mat-label>Дата завершення</mat-label>
                            <input
                                matInput
                                formControlName="endDate"
                                [matDatepicker]="endPicker"
                            />
                            <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                            <mat-datepicker #endPicker></mat-datepicker>
                            <mat-hint>Необов'язково</mat-hint>
                        </mat-form-field>
                    </div>

                    <!-- Category Selection -->
                    <mat-form-field appearance="outline">
                        <mat-label>Категорія</mat-label>
                        <mat-select formControlName="categoryId" placeholder="Оберіть категорію">
                            <mat-option>Без категорії</mat-option>
                            @for (category of categories; track category.id) {
                                <mat-option [value]="category.id">
                                    {{ category.name }}
                                </mat-option>
                            }
                        </mat-select>
                        <mat-hint>Необов'язково - для групування цілей</mat-hint>
                    </mat-form-field>
                </form>
            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-button (click)="closeDialog()">Скасувати</button>
                <button 
                    mat-raised-button 
                    color="primary" 
                    (click)="saveGoal()"
                    [disabled]="goalForm.invalid"
                >
                    Зберегти ціль
                </button>
            </mat-card-actions>
        </mat-card>
    </div>
</div>
